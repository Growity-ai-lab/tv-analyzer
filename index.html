<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV Analyzer by Time</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Sora:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.0.0"></script>
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a24;
            --accent-blue: #00d4ff;
            --accent-purple: #7c3aed;
            --accent-orange: #ff6b35;
            --accent-green: #10b981;
            --accent-yellow: #f59e0b;
            --accent-pink: #ec4899;
            --text-primary: #f0f0f5;
            --text-secondary: #8888a0;
            --border-color: #2a2a3a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Sora', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .bg-grid {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(0, 212, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 212, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1500px;
            margin: 0 auto;
            padding: 40px 24px;
            position: relative;
            z-index: 1;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 48px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Space Mono', monospace;
            font-weight: 700;
            font-size: 20px;
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.3);
        }

        .logo-text h1 {
            font-size: 24px;
            font-weight: 600;
            background: linear-gradient(90deg, var(--text-primary), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-text span {
            font-size: 12px;
            color: var(--text-secondary);
            font-family: 'Space Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .badge {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            color: var(--accent-blue);
            font-family: 'Space Mono', monospace;
        }

        .main-layout {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* Controls Row 1 - GRP + Scenarios + Run */
        .controls-row-1 {
            display: flex;
            gap: 16px;
            align-items: stretch;
        }

        .grp-card {
            flex: 1;
        }

        .grp-card .control-card-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding-bottom: 0;
            border-bottom: none;
        }

        .cpp-inline {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .cpp-inline input {
            width: 80px;
            padding: 4px 8px;
            font-size: 11px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            font-family: 'Space Mono', monospace;
        }

        .grp-inputs-row {
            display: flex;
            gap: 12px;
        }

        .grp-alt-input {
            flex: 1;
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 10px;
        }

        .grp-alt-header {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 8px;
        }

        .alt-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .alt-dot.alt1 { background: #00d4ff; }
        .alt-dot.alt2 { background: #ff6b35; }
        .alt-dot.alt3 { background: #10b981; }

        .alt-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .grp-alt-header .alt-total {
            margin-left: auto;
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            color: var(--text-secondary);
        }

        .grp-alt-input textarea {
            width: 100%;
            height: 36px;
            font-size: 11px;
            padding: 8px;
            resize: none;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'Space Mono', monospace;
        }

        .scenarios-card {
            width: 140px;
            flex-shrink: 0;
        }

        .scenarios-card .control-card-header {
            padding-bottom: 0;
            border-bottom: none;
            margin-bottom: 10px;
        }

        .scenario-buttons-vertical {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .scenario-btn-v {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .scenario-btn-v:hover {
            border-color: var(--accent-pink);
        }

        .scenario-btn-v.active {
            background: rgba(236, 72, 153, 0.15);
            border-color: var(--accent-pink);
        }

        .scenario-icon {
            font-size: 14px;
        }

        .scenario-name {
            font-size: 11px;
            color: var(--text-primary);
        }

        .run-analysis-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 20px 30px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .run-analysis-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
        }

        .run-icon {
            font-size: 24px;
            color: white;
        }

        .run-text {
            font-size: 12px;
            font-weight: 600;
            color: white;
            white-space: nowrap;
        }

        /* Controls Row 2 - Parameters */
        .controls-row-2 {
            display: flex;
            align-items: center;
            gap: 24px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 14px 20px;
        }

        .param-group {
            display: flex;
            gap: 24px;
        }

        .param-item {
            min-width: 140px;
        }

        .param-item label {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .param-item label span {
            color: var(--accent-blue);
            font-weight: 700;
            font-family: 'Space Mono', monospace;
        }

        .param-item input[type="range"] {
            width: 100%;
            height: 4px;
        }

        .param-scale {
            display: flex;
            justify-content: space-between;
            font-size: 8px;
            color: var(--text-secondary);
            margin-top: 2px;
            opacity: 0.6;
        }

        .param-divider {
            width: 1px;
            height: 50px;
            background: var(--border-color);
        }

        .sales-params {
            display: flex;
            gap: 16px;
        }

        .param-item-inline {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .param-item-inline label {
            font-size: 10px;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .param-item-inline input {
            width: 90px;
            padding: 6px 10px;
            font-size: 11px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'Space Mono', monospace;
        }

        .param-unit {
            font-size: 10px;
            color: var(--text-secondary);
        }

        /* Key Metrics - Simplified */
        .key-metrics {
            display: flex;
            align-items: stretch;
            gap: 16px;
        }

        .key-metric {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px 20px;
            min-width: 180px;
        }

        .key-metric.highlight-metric {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 107, 53, 0.05));
            border-color: rgba(255, 215, 0, 0.3);
            flex: 1;
        }

        .key-metric-icon {
            font-size: 24px;
        }

        .key-metric-content {
            display: flex;
            flex-direction: column;
        }

        .key-metric-value {
            font-family: 'Space Mono', monospace;
            font-size: 18px;
            font-weight: 700;
            color: var(--accent-yellow);
        }

        .key-metric-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .metric-details {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-left: auto;
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 10px 14px;
        }

        .metric-detail-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0 12px;
            border-right: 1px solid var(--border-color);
        }

        .metric-detail-item:last-child {
            border-right: none;
        }

        .detail-label {
            font-size: 8px;
            color: var(--text-secondary);
            text-transform: uppercase;
            white-space: nowrap;
        }

        .detail-value {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Control Card base */
        .control-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 14px;
        }

        .control-card-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .control-card-icon {
            font-size: 14px;
        }

        .control-card-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Charts Section */
        .charts-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 360px 1fr;
            gap: 32px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: rgba(0, 212, 255, 0.3);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.05);
        }

        .card.collapsed .card-body {
            display: none;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .card-header-content {
            flex: 1;
        }

        .card-toggle {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: transform 0.3s;
        }

        .card.collapsed .card-toggle {
            transform: rotate(-90deg);
        }

        .card-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .card-icon.blue { background: rgba(0, 212, 255, 0.15); }
        .card-icon.purple { background: rgba(124, 58, 237, 0.15); }
        .card-icon.orange { background: rgba(255, 107, 53, 0.15); }
        .card-icon.green { background: rgba(16, 185, 129, 0.15); }
        .card-icon.yellow { background: rgba(245, 158, 11, 0.15); }
        .card-icon.pink { background: rgba(236, 72, 153, 0.15); }

        .card h3 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .card p {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .card-body {
            margin-top: 16px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-group label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-family: 'Space Mono', monospace;
        }

        .form-group label span {
            color: var(--accent-blue);
            font-weight: 700;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--bg-secondary);
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--accent-blue);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
            transition: transform 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        input[type="number"], input[type="text"] {
            width: 100%;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px 14px;
            color: var(--text-primary);
            font-family: 'Space Mono', monospace;
            font-size: 13px;
            outline: none;
            transition: border-color 0.2s;
        }

        input[type="number"]:focus, input[type="text"]:focus {
            border-color: var(--accent-blue);
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .input-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        .data-input {
            width: 100%;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            color: var(--text-primary);
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            resize: vertical;
            min-height: 80px;
            outline: none;
        }

        .data-input:focus {
            border-color: var(--accent-blue);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-family: 'Sora', sans-serif;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            width: 100%;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white;
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(0, 212, 255, 0.4);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        .btn-sm {
            padding: 8px 14px;
            font-size: 11px;
        }

        .content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 14px;
        }

        .metric-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            transition: all 0.3s;
        }

        .metric-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent-blue);
        }

        .metric-value {
            font-family: 'Space Mono', monospace;
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .metric-value.blue { color: var(--accent-blue); }
        .metric-value.purple { color: var(--accent-purple); }
        .metric-value.orange { color: var(--accent-orange); }
        .metric-value.green { color: var(--accent-green); }
        .metric-value.yellow { color: var(--accent-yellow); }
        .metric-value.pink { color: var(--accent-pink); }

        .metric-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .tabs {
            display: flex;
            gap: 6px;
            background: var(--bg-card);
            padding: 5px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 100px;
            padding: 10px 16px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: 'Sora', sans-serif;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab.active {
            background: var(--bg-secondary);
            color: var(--accent-blue);
        }

        .tab:hover:not(.active) {
            color: var(--text-primary);
        }

        .chart-container {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            height: 380px;
            position: relative;
        }

        .chart-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-title::before {
            content: '';
            width: 4px;
            height: 18px;
            background: linear-gradient(180deg, var(--accent-blue), var(--accent-purple));
            border-radius: 2px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .data-table th {
            background: var(--bg-secondary);
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: sticky;
            top: 0;
        }

        .data-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border-color);
            font-family: 'Space Mono', monospace;
            font-size: 11px;
        }

        .data-table tr:hover td {
            background: rgba(0, 212, 255, 0.02);
        }

        .info-box {
            background: rgba(0, 212, 255, 0.05);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 10px;
            padding: 12px 14px;
            display: flex;
            gap: 10px;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .info-box-icon {
            font-size: 16px;
            color: var(--accent-blue);
        }

        .info-box-content h4 {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .info-box-content p {
            font-size: 11px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .formula {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 10px 14px;
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: var(--accent-blue);
            margin-top: 10px;
        }

        .param-guide {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            border-left: 3px solid var(--accent-purple);
        }

        .guide-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .guide-icon {
            font-size: 14px;
        }

        .guide-description {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .guide-scale {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
        }

        .scale-item {
            flex: 1;
            text-align: center;
            padding: 6px 4px;
            border-radius: 6px;
            background: rgba(255,255,255,0.03);
        }

        .scale-item.low { border-bottom: 2px solid #f59e0b; }
        .scale-item.mid { border-bottom: 2px solid var(--accent-blue); }
        .scale-item.high { border-bottom: 2px solid var(--accent-green); }

        .scale-value {
            display: block;
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .scale-label {
            font-size: 9px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .guide-examples {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .example-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            font-size: 10px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .example-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin-top: 4px;
            flex-shrink: 0;
        }

        .example-dot.low { background: #f59e0b; }
        .example-dot.mid { background: var(--accent-blue); }
        .example-dot.high { background: var(--accent-green); }

        .guide-effect {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed var(--border-color);
            font-size: 10px;
            color: var(--accent-orange);
            line-height: 1.5;
        }

        .effect-icon {
            font-size: 12px;
            flex-shrink: 0;
        }

        /* Optimal Point Indicator */
        .optimal-indicator {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(0, 212, 255, 0.1));
            border: 1px solid var(--accent-green);
            border-radius: 10px;
            padding: 14px;
            margin-top: 16px;
        }

        .optimal-indicator h4 {
            font-size: 12px;
            color: var(--accent-green);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .optimal-indicator .optimal-value {
            font-family: 'Space Mono', monospace;
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .optimal-indicator .optimal-desc {
            font-size: 10px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Scenario Comparison */
        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        .scenario-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .scenario-card:hover, .scenario-card.active {
            border-color: var(--accent-blue);
        }

        .scenario-card.active {
            background: rgba(0, 212, 255, 0.05);
        }

        .scenario-card h5 {
            font-size: 11px;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .scenario-card .scenario-params {
            font-size: 9px;
            color: var(--text-secondary);
            font-family: 'Space Mono', monospace;
        }

        /* GRP Calculator */
        .grp-result {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .grp-item {
            text-align: center;
        }

        .grp-item .value {
            font-family: 'Space Mono', monospace;
            font-size: 16px;
            font-weight: 700;
            color: var(--accent-yellow);
        }

        .grp-item .label {
            font-size: 9px;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-top: 2px;
        }

        /* Mode Selector */
        .mode-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 16px;
        }

        .mode-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 14px 10px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .mode-btn:hover {
            border-color: var(--accent-blue);
        }

        .mode-btn.active {
            border-color: var(--accent-blue);
            background: rgba(0, 212, 255, 0.1);
        }

        .mode-icon {
            font-size: 20px;
        }

        .mode-text {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .mode-btn.active .mode-text {
            color: var(--accent-blue);
        }

        .mode-content {
            display: none;
        }

        .mode-content.active {
            display: block;
        }

        /* Input Summary */
        .input-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .summary-item {
            text-align: center;
            padding: 10px 6px;
            background: var(--bg-secondary);
            border-radius: 8px;
        }

        .summary-value {
            font-family: 'Space Mono', monospace;
            font-size: 14px;
            font-weight: 700;
            color: var(--accent-blue);
        }

        .summary-label {
            font-size: 8px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        /* Export Buttons */
        .export-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        /* Toggle Switch */
        .toggle-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
        }

        .toggle-label {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .toggle {
            position: relative;
            width: 40px;
            height: 22px;
            background: var(--bg-secondary);
            border-radius: 11px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle.active {
            background: var(--accent-blue);
        }

        .toggle::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle.active::after {
            transform: translateX(18px);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            .metrics-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .scenario-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 500px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ROI Highlight */
        .roi-highlight {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(236, 72, 153, 0.1));
            border: 1px solid var(--accent-purple);
            border-radius: 10px;
            padding: 14px;
            text-align: center;
        }

        .roi-highlight .roi-value {
            font-family: 'Space Mono', monospace;
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .roi-highlight .roi-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 4px;
        }

        /* GRP & Reach Styles */
        .chart-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .reach-filters, .adstock-filters {
            display: flex;
            gap: 6px;
        }

        .reach-btn, .adstock-btn {
            padding: 8px 14px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            font-family: 'Sora', sans-serif;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .reach-btn:hover, .adstock-btn:hover {
            border-color: var(--accent-blue);
            color: var(--text-primary);
        }

        .reach-btn.active, .adstock-btn.active {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            color: white;
        }

        .reach-summary {
            display: flex;
            justify-content: center;
            gap: 32px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .reach-stat {
            text-align: center;
            padding: 12px 20px;
            background: var(--bg-secondary);
            border-radius: 8px;
            min-width: 100px;
        }

        .reach-stat-value {
            display: block;
            font-family: 'Space Mono', monospace;
            font-size: 20px;
            font-weight: 700;
            color: var(--accent-yellow);
        }

        .reach-stat-label {
            display: block;
            font-size: 9px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        /* Reach Stats Row - grafikten ayrÄ± */
        .reach-stats-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 16px 0;
        }

        .reach-stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 14px 24px;
            text-align: center;
            min-width: 120px;
        }

        .reach-stat-card .reach-stat-value {
            display: block;
            font-family: 'Space Mono', monospace;
            font-size: 18px;
            font-weight: 700;
            color: var(--accent-yellow);
        }

        .reach-stat-card .reach-stat-label {
            display: block;
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        /* Tab Rationale (All tabs) */
        .tab-rationale {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-top: 16px;
        }

        .rationale-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 14px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .rationale-icon {
            font-size: 18px;
        }

        .rationale-content {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .rationale-content p {
            margin-bottom: 12px;
        }

        .rationale-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .rationale-content li {
            margin-bottom: 6px;
        }

        .rationale-content strong {
            color: var(--text-primary);
        }

        .rationale-content .highlight {
            color: #ef4444;
            font-weight: 600;
        }

        .rationale-content .highlight-green {
            color: #10b981;
            font-weight: 600;
        }

        .rationale-content .highlight-blue {
            color: #00d4ff;
            font-weight: 600;
        }

        .rationale-content .highlight-purple {
            color: #7c3aed;
            font-weight: 600;
        }

        .rationale-recommendation {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(0, 212, 255, 0.05));
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
        }

        .rationale-recommendation strong {
            color: #10b981;
            display: block;
            margin-bottom: 6px;
        }

        .rationale-recommendation p {
            margin: 6px 0;
        }

        .rationale-tip {
            background: rgba(124, 58, 237, 0.1);
            border-left: 3px solid #7c3aed;
            padding: 10px 12px;
            margin: 12px 0;
            border-radius: 0 8px 8px 0;
        }

        .rationale-tip strong {
            color: #7c3aed;
        }

        .rationale-data-section {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
        }

        .rationale-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px;
            font-size: 11px;
        }

        .rationale-table th,
        .rationale-table td {
            padding: 6px 8px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        .rationale-table th {
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 10px;
            text-transform: uppercase;
        }

        .rationale-table td:first-child {
            text-align: left;
        }

        .status-good { color: #10b981; font-weight: 600; }
        .status-warning { color: #f59e0b; font-weight: 600; }
        .status-info { color: #00d4ff; font-weight: 600; }

        .rationale-recommendation.warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(239, 68, 68, 0.1));
            border-color: rgba(245, 158, 11, 0.4);
        }

        .rationale-recommendation.warning strong {
            color: #f59e0b;
        }

        .rationale-recommendation.info {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(124, 58, 237, 0.05));
            border-color: rgba(0, 212, 255, 0.3);
        }

        .rationale-recommendation.info strong {
            color: #00d4ff;
        }

        .rationale-recommendation ul {
            margin: 8px 0;
            padding-left: 18px;
        }

        .rationale-recommendation li {
            margin-bottom: 4px;
        }

        .rationale-scenario {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            border-left: 3px solid var(--accent-pink);
        }

        .rationale-scenario-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--accent-pink);
            margin-bottom: 8px;
        }

        /* Alternative Input Styles */
        .alt-input-group {
            margin-bottom: 12px;
            padding: 10px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border-left: 3px solid var(--border-color);
        }

        .alt-input-group:nth-child(2) { border-left-color: #00d4ff; }
        .alt-input-group:nth-child(3) { border-left-color: #ff6b35; }
        .alt-input-group:nth-child(4) { border-left-color: #10b981; }

        .alt-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .alt-badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            font-family: 'Space Mono', monospace;
        }

        .alt-badge.alt1 { background: #00d4ff; color: #0a0a0f; }
        .alt-badge.alt2 { background: #ff6b35; color: white; }
        .alt-badge.alt3 { background: #10b981; color: white; }

        .alt-name {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .alt-input-group .data-input {
            height: 50px;
            font-size: 11px;
        }

        .alt-summary {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
        }

        .alt-summary-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 10px;
            background: var(--bg-secondary);
            border-radius: 6px;
        }

        .alt-summary-value {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .param-hint {
            font-size: 10px;
            color: var(--text-secondary);
            margin-top: 4px;
            font-style: italic;
        }

        /* Chart Legend for Alternatives */
        .alt-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 12px;
        }

        .alt-legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .alt-legend-color {
            width: 12px;
            height: 3px;
            border-radius: 2px;
        }

        .alt-legend-color.alt1 { background: #00d4ff; }
        .alt-legend-color.alt2 { background: #ff6b35; }
        .alt-legend-color.alt3 { background: #10b981; }

        /* Compact Alternative Input */
        .alt-input-compact {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .alt-row {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .alt-row .alt-badge {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            flex-shrink: 0;
        }

        .alt-row textarea {
            flex: 1;
            height: 28px;
            font-size: 10px;
            padding: 4px 6px;
            resize: none;
        }

        .alt-total {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            color: var(--text-secondary);
            min-width: 35px;
            text-align: right;
        }

        /* Metrics Row */
        .metrics-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .metric-mini {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 100px;
            flex: 1;
        }

        .metric-mini.highlight {
            background: rgba(255, 215, 0, 0.1);
            border-color: rgba(255, 215, 0, 0.3);
        }

        .metric-mini-value {
            font-family: 'Space Mono', monospace;
            font-size: 14px;
            font-weight: 700;
        }

        .metric-mini-value.blue { color: #00d4ff; }
        .metric-mini-value.purple { color: #7c3aed; }
        .metric-mini-value.orange { color: #ff6b35; }
        .metric-mini-value.green { color: #10b981; }
        .metric-mini-value.pink { color: #ec4899; }
        .metric-mini-value.yellow { color: #ffd700; }
        .metric-mini-value.cyan { color: #00d4ff; }

        .metric-mini-label {
            font-size: 9px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-top: 2px;
        }

        /* Scenario Buttons */
        .scenario-buttons {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .scenario-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 6px 10px;
            color: var(--text-secondary);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .scenario-btn:hover {
            border-color: var(--accent-pink);
            color: var(--text-primary);
        }

        .scenario-btn.active {
            background: rgba(236, 72, 153, 0.1);
            border-color: var(--accent-pink);
            color: var(--accent-pink);
        }

        .scenario-info {
            margin-top: 8px;
            padding: 8px;
            background: var(--bg-secondary);
            border-radius: 6px;
            border-left: 2px solid var(--accent-pink);
        }

        .scenario-params-mini {
            display: block;
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            color: var(--accent-pink);
        }

        .scenario-desc {
            display: block;
            font-size: 9px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        /* Compact Button */
        .btn-compact {
            width: 100%;
            padding: 8px;
            font-size: 11px;
            margin-top: 8px;
        }

        /* Scenario Explanation */
        .scenario-explanation {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 14px;
            margin-top: 16px;
            border-left: 3px solid var(--accent-pink);
        }

        .explanation-header {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .explanation-content {
            font-size: 11px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .explanation-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--accent-pink);
            margin-bottom: 8px;
        }

        .explanation-content ul {
            margin: 8px 0;
            padding-left: 16px;
        }

        .explanation-content li {
            margin-bottom: 4px;
        }

        .explanation-content strong {
            color: var(--text-primary);
        }

        .explanation-usage {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed var(--border-color);
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    
    <div class="container">
        <header class="header">
            <div class="logo">
                <div class="logo-icon">TV</div>
                <div class="logo-text">
                    <h1>TV Analyzer</h1>
                    <span>by Time & Growity</span>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary btn-sm" onclick="exportCSV()">
                    ðŸ“¥ CSV Export
                </button>
                <div class="badge">v2.1</div>
            </div>
        </header>

        <div class="main-layout">
            <!-- Top Controls - Row 1: GRP + Scenarios + Run Button -->
            <div class="controls-row-1">
                <!-- GRP Alternatives - Wider -->
                <div class="control-card grp-card">
                    <div class="control-card-header">
                        <span class="control-card-icon">ðŸ“Š</span>
                        <span class="control-card-title">GRP Alternatifleri</span>
                        <div class="cpp-inline">
                            <span>CPP:</span>
                            <input type="number" id="cppValue" value="25000" step="1000">
                            <span>TL</span>
                        </div>
                    </div>
                    <div class="grp-inputs-row">
                        <div class="grp-alt-input">
                            <div class="grp-alt-header">
                                <span class="alt-dot alt1"></span>
                                <span class="alt-label">Alt-1</span>
                                <span class="alt-total" id="summaryAlt1">1700 GRP</span>
                            </div>
                            <textarea class="data-input" id="grpAlt1" placeholder="Hafta 1, Hafta 2, ...">300, 300, 200, 200, 200, 100, 200, 200</textarea>
                        </div>
                        <div class="grp-alt-input">
                            <div class="grp-alt-header">
                                <span class="alt-dot alt2"></span>
                                <span class="alt-label">Alt-2</span>
                                <span class="alt-total" id="summaryAlt2">1700 GRP</span>
                            </div>
                            <textarea class="data-input" id="grpAlt2" placeholder="Hafta 1, Hafta 2, ...">300, 250, 250, 200, 200, 200, 150, 150</textarea>
                        </div>
                        <div class="grp-alt-input">
                            <div class="grp-alt-header">
                                <span class="alt-dot alt3"></span>
                                <span class="alt-label">Alt-3</span>
                                <span class="alt-total" id="summaryAlt3">1700 GRP</span>
                            </div>
                            <textarea class="data-input" id="grpAlt3" placeholder="Hafta 1, Hafta 2, ...">400, 200, 200, 200, 200, 200, 150, 150</textarea>
                        </div>
                    </div>
                </div>

                <!-- Scenarios -->
                <div class="control-card scenarios-card">
                    <div class="control-card-header">
                        <span class="control-card-icon">ðŸŽ¯</span>
                        <span class="control-card-title">Senaryo</span>
                    </div>
                    <div class="scenario-buttons-vertical">
                        <button class="scenario-btn-v" onclick="applyScenario('minimum')">
                            <span class="scenario-icon">ðŸ“‰</span>
                            <span class="scenario-name">Minimum</span>
                        </button>
                        <button class="scenario-btn-v active" onclick="applyScenario('optimum')">
                            <span class="scenario-icon">âš–ï¸</span>
                            <span class="scenario-name">Optimum</span>
                        </button>
                        <button class="scenario-btn-v" onclick="applyScenario('maksimum')">
                            <span class="scenario-icon">ðŸ“ˆ</span>
                            <span class="scenario-name">Maksimum</span>
                        </button>
                    </div>
                </div>

                <!-- Run Button - Prominent -->
                <button class="run-analysis-btn" onclick="runAnalysis()">
                    <span class="run-icon">â–¶</span>
                    <span class="run-text">Analizi Ã‡alÄ±ÅŸtÄ±r</span>
                </button>
            </div>

            <!-- Top Controls - Row 2: Parameters -->
            <div class="controls-row-2">
                <!-- Model Parameters -->
                <div class="param-group">
                    <div class="param-item">
                        <label>ðŸ“… Etki SÃ¼resi <span id="decayValue">0.70</span></label>
                        <input type="range" id="decayRate" min="0" max="0.95" step="0.05" value="0.70">
                        <div class="param-scale">
                            <span>KÄ±sa</span>
                            <span>Uzun</span>
                        </div>
                    </div>
                    <div class="param-item">
                        <label>ðŸ“Š Doygunluk <span id="alphaValue">1.50</span></label>
                        <input type="range" id="alphaParam" min="0.5" max="5" step="0.1" value="1.5">
                        <div class="param-scale">
                            <span>Erken</span>
                            <span>GeÃ§</span>
                        </div>
                    </div>
                    <div class="param-item">
                        <label>âš¡ Etki HÄ±zÄ± <span id="gammaValue">0.80</span></label>
                        <input type="range" id="gammaParam" min="0.3" max="2" step="0.05" value="0.80">
                        <div class="param-scale">
                            <span>YavaÅŸ</span>
                            <span>HÄ±zlÄ±</span>
                        </div>
                    </div>
                </div>

                <div class="param-divider"></div>

                <!-- Sales Parameters -->
                <div class="param-group sales-params">
                    <div class="param-item-inline">
                        <label>ðŸª Baz SatÄ±ÅŸ</label>
                        <input type="number" id="baseline" value="5000000" step="100000">
                        <span class="param-unit">TL/hafta</span>
                    </div>
                    <div class="param-item-inline">
                        <label>ðŸ“ˆ Max TV Etkisi</label>
                        <input type="number" id="maxLift" value="30" step="1">
                        <span class="param-unit">%</span>
                    </div>
                </div>
            </div>

            <!-- Key Metrics - Simplified to 3 main + details -->
            <div class="key-metrics">
                <div class="key-metric">
                    <div class="key-metric-icon">ðŸ’°</div>
                    <div class="key-metric-content">
                        <span class="key-metric-value" id="totalSpend">-</span>
                        <span class="key-metric-label">Toplam Harcama</span>
                    </div>
                </div>
                <div class="key-metric highlight-metric">
                    <div class="key-metric-icon">ðŸ“ˆ</div>
                    <div class="key-metric-content">
                        <span class="key-metric-value" id="overallROI">-</span>
                        <span class="key-metric-label">TV KaynaklÄ± SatÄ±ÅŸ ArtÄ±ÅŸÄ±</span>
                    </div>
                </div>
                <div class="key-metric">
                    <div class="key-metric-icon">âš¡</div>
                    <div class="key-metric-content">
                        <span class="key-metric-value" id="tvEfficiency">-</span>
                        <span class="key-metric-label">Verimlilik Index</span>
                    </div>
                </div>
                <div class="metric-details">
                    <div class="metric-detail-item">
                        <span class="detail-label">Ort. Adstock</span>
                        <span class="detail-value" id="avgAdstock">-</span>
                    </div>
                    <div class="metric-detail-item">
                        <span class="detail-label">Peak Saturation</span>
                        <span class="detail-value" id="peakEffect">-</span>
                    </div>
                    <div class="metric-detail-item">
                        <span class="detail-label">Optimal BÃ¼tÃ§e</span>
                        <span class="detail-value" id="optimalBudget">-</span>
                    </div>
                    <div class="metric-detail-item">
                        <span class="detail-label">Toplam SatÄ±ÅŸ</span>
                        <span class="detail-value" id="totalResponse">-</span>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-section">
                <!-- Tabs -->
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('adstock')">Adstock</button>
                    <button class="tab" onclick="switchTab('carryover')">Carryover</button>
                    <button class="tab" onclick="switchTab('saturation')">Saturation</button>
                    <button class="tab" onclick="switchTab('reach')">GRP & Reach</button>
                </div>

                <!-- Chart Containers -->
                <div id="adstock-tab" class="tab-content active">
                    <div class="chart-container">
                        <div class="chart-header-row">
                            <div class="chart-title">HaftalÄ±k GRP + Carryover Birikimi</div>
                            <div class="adstock-filters">
                                <button class="adstock-btn active" onclick="setAdstockAlt(1)">Alt-1</button>
                                <button class="adstock-btn" onclick="setAdstockAlt(2)">Alt-2</button>
                                <button class="adstock-btn" onclick="setAdstockAlt(3)">Alt-3</button>
                            </div>
                        </div>
                        <div style="height: 350px;">
                            <canvas id="adstockChart"></canvas>
                        </div>
                    </div>
                    <div class="tab-rationale">
                        <div class="rationale-header">
                            <span class="rationale-icon">ðŸ“Š</span>
                            <span>Grafik Rasyoneli</span>
                        </div>
                        <div class="rationale-content" id="adstockRationale">
                            <!-- Dinamik iÃ§erik buraya gelecek -->
                        </div>
                    </div>
                </div>

                <div id="carryover-tab" class="tab-content">
                    <div class="chart-container">
                        <div class="chart-header-row">
                            <div class="chart-title">Carryover Etkisi - GeÃ§miÅŸten TaÅŸÄ±nan Reklam DeÄŸeri</div>
                            <div class="adstock-filters">
                                <button class="adstock-btn active" onclick="setCarryoverAlt(1)">Alt-1</button>
                                <button class="adstock-btn" onclick="setCarryoverAlt(2)">Alt-2</button>
                                <button class="adstock-btn" onclick="setCarryoverAlt(3)">Alt-3</button>
                            </div>
                        </div>
                        <div style="height: 350px;">
                            <canvas id="carryoverChart"></canvas>
                        </div>
                    </div>
                    <div class="tab-rationale">
                        <div class="rationale-header">
                            <span class="rationale-icon">ðŸ“Š</span>
                            <span>Grafik Rasyoneli</span>
                        </div>
                        <div class="rationale-content" id="carryoverRationale">
                            <!-- Dinamik iÃ§erik buraya gelecek -->
                        </div>
                    </div>
                </div>

                <div id="saturation-tab" class="tab-content">
                    <div class="chart-container">
                        <div class="chart-title">Saturation Curve - Optimal Nokta Ä°ÅŸaretli</div>
                        <canvas id="saturationChart"></canvas>
                    </div>
                    <div class="tab-rationale">
                        <div class="rationale-header">
                            <span class="rationale-icon">ðŸ“Š</span>
                            <span>Grafik Rasyoneli</span>
                        </div>
                        <div class="rationale-content" id="saturationRationale">
                            <!-- Dinamik iÃ§erik buraya gelecek -->
                        </div>
                    </div>
                </div>

                <!-- GRP & Reach Tab -->
                <div id="reach-tab" class="tab-content">
                    <div class="chart-container">
                        <div class="chart-header-row">
                            <div class="chart-title">HaftalÄ±k GRP & EriÅŸim Seviyesi</div>
                            <div class="reach-filters">
                                <button class="reach-btn" onclick="setReachFrequency('all')">Hepsi</button>
                                <button class="reach-btn active" onclick="setReachFrequency(1)">1+ Reach</button>
                                <button class="reach-btn" onclick="setReachFrequency(2)">2+ Reach</button>
                                <button class="reach-btn" onclick="setReachFrequency(3)">3+ Reach</button>
                            </div>
                        </div>
                        <div style="height: 350px;">
                            <canvas id="reachChart"></canvas>
                        </div>
                    </div>
                    <!-- Summary kutularÄ± grafikten AYRI -->
                    <div class="reach-stats-row">
                        <div class="reach-stat-card">
                            <span class="reach-stat-value" id="reachMaxGRP">-</span>
                            <span class="reach-stat-label">Toplam GRP</span>
                        </div>
                        <div class="reach-stat-card">
                            <span class="reach-stat-value" id="reachMaxPercent">-</span>
                            <span class="reach-stat-label" id="reachFreqLabel">1+ Reach</span>
                        </div>
                        <div class="reach-stat-card">
                            <span class="reach-stat-value" id="reachOptimalGRP">-</span>
                            <span class="reach-stat-label">Optimal GRP</span>
                        </div>
                    </div>
                    <div class="tab-rationale">
                        <div class="rationale-header">
                            <span class="rationale-icon">ðŸ“Š</span>
                            <span>Grafik Rasyoneli</span>
                        </div>
                        <div class="rationale-content" id="reachRationale">
                            <!-- Dinamik iÃ§erik buraya gelecek -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let adstockChart, saturationChart, carryoverChart, reachChart;
        let analysisData = {};
        let inputMode = 'spend'; // 'spend' or 'grp'
        let currentReachFrequency = 1; // 1+, 2+, or 3+
        let currentAdstockAlt = 1; // 1, 2, or 3
        let currentCarryoverAlt = 1; // 1, 2, or 3
        let currentScenario = 'optimum'; // 'minimum', 'optimum', or 'maksimum'

        // Reach curve parameters for different frequencies
        const reachParams = {
            1: { maxReach: 72, k: 0.012, label: '1+ Reach' },  // 1+ frequency
            2: { maxReach: 58, k: 0.010, label: '2+ Reach' },  // 2+ frequency
            3: { maxReach: 45, k: 0.008, label: '3+ Reach' }   // 3+ frequency
        };

        // Scenario-specific rationale content
        const scenarioRationales = {
            minimum: {
                name: 'Minimum',
                icon: 'ðŸ“‰',
                adstock: {
                    main: `<p><strong>ðŸ“Š Grafik Ne GÃ¶steriyor?</strong></p>
                    <ul>
                        <li><strong>Barlar (solda):</strong> HaftalÄ±k GRP deÄŸerleri - her hafta ne kadar TV yatÄ±rÄ±mÄ± yapÄ±ldÄ±ÄŸÄ±nÄ± gÃ¶sterir</li>
                        <li><strong>DÃ¼z Ã§izgi:</strong> Toplam Adstock - o haftadaki birikimli reklam etkisi (bu hafta + geÃ§miÅŸten taÅŸÄ±nan)</li>
                        <li><strong>Kesikli Ã§izgi + alan:</strong> Carryover - sadece geÃ§miÅŸ haftalardan taÅŸÄ±nan etki miktarÄ±</li>
                    </ul>
                    <p><strong>Minimum Senaryo (Î» = 0.45):</strong> DÃ¼ÅŸÃ¼k decay ile reklam etkisi <span class="highlight">1-2 hafta iÃ§inde %80+ kaybolur</span>.</p>`,
                    scenario: `<p><strong>ðŸ“‰ Grafikte Ne GÃ¶rmelisiniz?</strong></p>
                    <ul>
                        <li>Kesikli alan (carryover) Ã§ok dar - geÃ§miÅŸten az etki taÅŸÄ±nÄ±yor</li>
                        <li>DÃ¼z Ã§izgi barlara yakÄ±n seyreder - etki Ã§oÄŸunlukla o haftanÄ±n yatÄ±rÄ±mÄ±ndan</li>
                        <li>GRP olmayan haftalarda adstock hÄ±zla dÃ¼ÅŸer</li>
                    </ul>
                    <div class="rationale-recommendation warning">
                        <strong>âš ï¸ Dikkat Edilmesi Gerekenler:</strong>
                        <p>Carryover alanÄ± Ã§ok darsa, her hafta yeniden "sÄ±fÄ±rdan" baÅŸlÄ±yorsunuz demektir. Bu durumda:</p>
                        <ul>
                            <li>SÃ¼rekli yayÄ±n yapmalÄ±sÄ±nÄ±z, 1 hafta bile boÅŸluk etkiyi sÄ±fÄ±rlar</li>
                            <li>Burst stratejisi bu senaryoda verimsizdir</li>
                        </ul>
                    </div>
                    <div class="rationale-recommendation">
                        <strong>ðŸ’¡ Aksiyon Ã–nerileri:</strong>
                        <ul>
                            <li>HaftalÄ±k minimum 150-200 GRP ile sÃ¼rekli yayÄ±n planlayÄ±n</li>
                            <li>Promosyon dÃ¶nemlerinde yoÄŸunlaÅŸtÄ±rÄ±n ama hiÃ§ bÄ±rakmayÄ±n</li>
                            <li>Flight (ara verme) stratejisi kullanmayÄ±n</li>
                        </ul>
                    </div>
                    <div class="rationale-tip">
                        <strong>ðŸ“Š Benchmark:</strong> FMCG sektÃ¶rÃ¼nde tipik decay 0.4-0.5 arasÄ±ndadÄ±r.
                    </div>`
                },
                carryover: {
                    main: `<p><strong>ðŸ“Š Grafik Ne GÃ¶steriyor?</strong> Carryover = geÃ§miÅŸ haftalardan taÅŸÄ±nan reklam etkisi. Her haftanÄ±n Ã§ubuÄŸu, o haftaya Ã¶nceki yayÄ±nlardan kalan "miras" etkiyi gÃ¶sterir.</p>
                    <p><strong>Minimum Senaryo:</strong> <span class="highlight">Carryover Ã§ok dÃ¼ÅŸÃ¼k</span> - geÃ§miÅŸ yatÄ±rÄ±mlar hÄ±zla deÄŸer kaybeder.</p>`,
                    scenario: `<p><strong>ðŸ“‰ Grafikte Ne GÃ¶rmelisiniz?</strong></p>
                    <ul>
                        <li>Barlar Ã§ok kÄ±sa - geÃ§miÅŸten az etki taÅŸÄ±nÄ±yor</li>
                        <li>YayÄ±n olmayan haftalarda carryover hÄ±zla sÄ±fÄ±rlanÄ±r</li>
                        <li>Her hafta neredeyse "sÄ±fÄ±rdan" baÅŸlÄ±yorsunuz</li>
                    </ul>
                    <div class="rationale-recommendation warning">
                        <strong>âš ï¸ UyarÄ±:</strong> Carryover dÃ¼ÅŸÃ¼kse her hafta yeniden yatÄ±rÄ±m gerekir. SÃ¼rekli yayÄ±n ÅŸarttÄ±r!
                    </div>`
                },
                saturation: {
                    main: `<p><strong>Saturation GrafiÄŸi Ne GÃ¶steriyor?</strong> Harcama arttÄ±kÃ§a elde edilen etkinin nasÄ±l deÄŸiÅŸtiÄŸini gÃ¶sterir.</p>
                    <p><strong>Minimum Senaryo (Î± = 1.0, Î³ = 1.3):</strong> DÃ¼ÅŸÃ¼k alpha = <span class="highlight">erken doygunluk</span>. YÃ¼ksek gamma = keskin S-eÄŸrisi.</p>`,
                    scenario: `<p><strong>ðŸ“‰ Minimum Saturation Ã–zellikleri:</strong></p>
                    <ul>
                        <li>Belirli bir eÅŸiÄŸe kadar dÃ¼ÅŸÃ¼k etki</li>
                        <li>EÅŸik aÅŸÄ±ldÄ±ÄŸÄ±nda hÄ±zlÄ± verim artÄ±ÅŸÄ±</li>
                        <li>Optimal noktayÄ± aÅŸmak israftÄ±r</li>
                    </ul>`
                },
                reach: {
                    main: `<p><strong>GRP-Reach GrafiÄŸi Ne GÃ¶steriyor?</strong> KÃ¼mÃ¼latif GRP'nin ne kadar kitleye ulaÅŸtÄ±ÄŸÄ±nÄ± gÃ¶sterir.</p>`,
                    scenario: `<p><strong>ðŸ“Œ Minimum Senaryo iÃ§in Reach Stratejisi:</strong></p>
                    <ul>
                        <li><strong>3+ Reach:</strong> â­ Ã–nerilen - yÃ¼ksek frekans ile anlÄ±k etki</li>
                    </ul>
                    <div class="rationale-recommendation">
                        <strong>ðŸ’¡ Aksiyon:</strong> HaftalÄ±k 250-350 GRP ile 3+ reach %30-40 hedefleyin.
                    </div>`
                }
            },
            optimum: {
                name: 'Optimum',
                icon: 'âš–ï¸',
                adstock: {
                    main: `<p><strong>ðŸ“Š Grafik Ne GÃ¶steriyor?</strong></p>
                    <ul>
                        <li><strong>Barlar (solda):</strong> HaftalÄ±k GRP deÄŸerleri - her hafta ne kadar TV yatÄ±rÄ±mÄ± yapÄ±ldÄ±ÄŸÄ±nÄ± gÃ¶sterir</li>
                        <li><strong>DÃ¼z Ã§izgi:</strong> Toplam Adstock - o haftadaki birikimli reklam etkisi (bu hafta + geÃ§miÅŸten taÅŸÄ±nan)</li>
                        <li><strong>Kesikli Ã§izgi + alan:</strong> Carryover - sadece geÃ§miÅŸ haftalardan taÅŸÄ±nan etki miktarÄ±</li>
                    </ul>
                    <p><strong>Optimum Senaryo (Î» = 0.70):</strong> Dengeli decay ile reklam etkisi <span class="highlight-purple">2-3 hafta boyunca %50+ korunur</span>.</p>`,
                    scenario: `<p><strong>âš–ï¸ Grafikte Ne GÃ¶rmelisiniz?</strong></p>
                    <ul>
                        <li>Kesikli alan (carryover) orta geniÅŸlikte - geÃ§miÅŸten makul etki taÅŸÄ±nÄ±yor</li>
                        <li>DÃ¼z Ã§izgi barlarÄ±n Ã¼zerinde seyreder - birikim etkisi var</li>
                        <li>GRP olmayan haftalarda adstock kademeli dÃ¼ÅŸer ama sÄ±fÄ±rlanmaz</li>
                    </ul>
                    <div class="rationale-recommendation">
                        <strong>ðŸ’¡ GrafiÄŸi NasÄ±l YorumlamalÄ±sÄ±nÄ±z?</strong>
                        <ul>
                            <li><strong>Carryover alanÄ± geniÅŸse:</strong> GeÃ§miÅŸ yatÄ±rÄ±mlarÄ±nÄ±z hÃ¢lÃ¢ Ã§alÄ±ÅŸÄ±yor, burst stratejisi kullanabilirsiniz</li>
                            <li><strong>DÃ¼z Ã§izgi barlardan Ã§ok yÃ¼ksekse:</strong> GÃ¼Ã§lÃ¼ birikim var, yoÄŸunlaÅŸtÄ±rma etkili</li>
                            <li><strong>Alternatifler arasÄ±nda fark varsa:</strong> Daha yÃ¼ksek carryover'lÄ± alternatif uzun vadede verimli</li>
                        </ul>
                    </div>
                    <div class="rationale-recommendation">
                        <strong>ðŸŽ¯ Aksiyon Ã–nerileri:</strong>
                        <ul>
                            <li>2-3 haftalÄ±k burst dÃ¶nemleri planlayabilirsiniz</li>
                            <li>1-2 hafta yayÄ±n arasÄ± (flight) verilebilir</li>
                            <li>Sezonsal yoÄŸunlaÅŸtÄ±rma stratejisi uygundur</li>
                            <li>HaftalÄ±k 200-300 GRP ile istikrarlÄ± birikim saÄŸlayÄ±n</li>
                        </ul>
                    </div>
                    <div class="rationale-tip">
                        <strong>ðŸ“Š Benchmark:</strong> Petrol, telekom, market sektÃ¶rlerinde tipik decay 0.65-0.75 arasÄ±ndadÄ±r.
                    </div>`
                },
                carryover: {
                    main: `<p><strong>ðŸ“Š Grafik Ne GÃ¶steriyor?</strong> Carryover = geÃ§miÅŸ haftalardan taÅŸÄ±nan reklam etkisi. Decay oranÄ±na gÃ¶re her hafta azalarak devam eder.</p>
                    <p><strong>Optimum Senaryo:</strong> <span class="highlight-purple">Makul carryover</span> - yatÄ±rÄ±mlar 2-3 hafta boyunca deÄŸer Ã¼retmeye devam eder.</p>`,
                    scenario: `<p><strong>âš–ï¸ Grafikte Ne GÃ¶rmelisiniz?</strong></p>
                    <ul>
                        <li>Barlar orta yÃ¼kseklikte - dengeli taÅŸÄ±ma etkisi</li>
                        <li>GRP olmayan haftalarda bile carryover sÄ±fÄ±rlanmaz</li>
                        <li>2-3 haftalÄ±k flight dÃ¶nemleri kabul edilebilir</li>
                    </ul>
                    <div class="rationale-recommendation">
                        <strong>ðŸ’¡ Aksiyon:</strong> Burst stratejisi uygulayabilirsiniz - yoÄŸun yayÄ±n sonrasÄ± carryover Ã§alÄ±ÅŸÄ±r.
                    </div>`
                },
                saturation: {
                    main: `<p><strong>Saturation GrafiÄŸi Ne GÃ¶steriyor?</strong> Harcama arttÄ±kÃ§a elde edilen etkinin nasÄ±l deÄŸiÅŸtiÄŸini gÃ¶sterir.</p>
                    <p><strong>Optimum Senaryo (Î± = 1.5, Î³ = 0.8):</strong> Orta alpha = <span class="highlight-purple">dengeli doygunluk noktasÄ±</span>.</p>`,
                    scenario: `<p><strong>âš–ï¸ Optimum Saturation Ã–zellikleri:</strong></p>
                    <ul>
                        <li>Optimal noktaya kadar iyi verim</li>
                        <li>Optimal sonrasÄ± kademeli azalan getiri</li>
                        <li>BÃ¼tÃ§e planlamasÄ±nda esneklik</li>
                    </ul>`
                },
                reach: {
                    main: `<p><strong>GRP-Reach GrafiÄŸi Ne GÃ¶steriyor?</strong> KÃ¼mÃ¼latif GRP'nin ne kadar kitleye ulaÅŸtÄ±ÄŸÄ±nÄ± gÃ¶sterir.</p>`,
                    scenario: `<p><strong>ðŸ“Œ Optimum Senaryo iÃ§in Reach Stratejisi:</strong></p>
                    <ul>
                        <li><strong>2+ Reach:</strong> â­ Ã–nerilen - maliyet-etkinlik dengesi</li>
                    </ul>
                    <div class="rationale-recommendation">
                        <strong>ðŸ’¡ Aksiyon:</strong> 2+ reach %45-55 hedefleyin.
                    </div>`
                }
            },
            maksimum: {
                name: 'Maksimum',
                icon: 'ðŸ“ˆ',
                adstock: {
                    main: `<p><strong>ðŸ“Š Grafik Ne GÃ¶steriyor?</strong></p>
                    <ul>
                        <li><strong>Barlar (solda):</strong> HaftalÄ±k GRP deÄŸerleri - her hafta ne kadar TV yatÄ±rÄ±mÄ± yapÄ±ldÄ±ÄŸÄ±nÄ± gÃ¶sterir</li>
                        <li><strong>DÃ¼z Ã§izgi:</strong> Toplam Adstock - o haftadaki birikimli reklam etkisi (bu hafta + geÃ§miÅŸten taÅŸÄ±nan)</li>
                        <li><strong>Kesikli Ã§izgi + alan:</strong> Carryover - sadece geÃ§miÅŸ haftalardan taÅŸÄ±nan etki miktarÄ±</li>
                    </ul>
                    <p><strong>Maksimum Senaryo (Î» = 0.85):</strong> YÃ¼ksek decay ile reklam etkisi <span class="highlight-green">4-5 hafta boyunca %60+ korunur</span>.</p>`,
                    scenario: `<p><strong>ðŸ“ˆ Grafikte Ne GÃ¶rmelisiniz?</strong></p>
                    <ul>
                        <li>Adstock Ã§izgisi GRP barlarÄ±nÄ±n Ã§ok Ã¼zerinde</li>
                        <li>GRP olmayan haftalarda bile adstock yÃ¼ksek kalÄ±r</li>
                        <li>Peak noktalarÄ± birkaÃ§ hafta gecikmeyle oluÅŸabilir</li>
                    </ul>
                    <div class="rationale-recommendation">
                        <strong>ðŸŽ¯ Aksiyon:</strong> Ä°lk 2-3 haftada yoÄŸun GRP (300+), sonra dÃ¼ÅŸÃ¼k seviyede sÃ¼rdÃ¼rÃ¼n.
                    </div>`
                },
                carryover: {
                    main: `<p><strong>ðŸ“Š Grafik Ne GÃ¶steriyor?</strong> Carryover = geÃ§miÅŸ haftalardan taÅŸÄ±nan reklam etkisi. Maksimum senaryoda bu etki Ã§ok gÃ¼Ã§lÃ¼ ve uzun sÃ¼relidir.</p>
                    <p><strong>Maksimum Senaryo:</strong> <span class="highlight-green">Ã‡ok yÃ¼ksek carryover</span> - yatÄ±rÄ±mlar 4-5 hafta boyunca deÄŸer Ã¼retmeye devam eder.</p>`,
                    scenario: `<p><strong>ðŸ“ˆ Grafikte Ne GÃ¶rmelisiniz?</strong></p>
                    <ul>
                        <li>Barlar Ã§ok yÃ¼ksek - geÃ§miÅŸten gÃ¼Ã§lÃ¼ etki taÅŸÄ±nÄ±yor</li>
                        <li>YayÄ±n bitiminden haftalarca sonra bile carryover sÄ±fÄ±rlanmaz</li>
                        <li>Flight stratejisi bu senaryoda Ã§ok etkili</li>
                    </ul>
                    <div class="rationale-recommendation">
                        <strong>ðŸ’¡ Aksiyon:</strong> Burst + maintenance stratejisi uygulayÄ±n. YoÄŸun yayÄ±n sonrasÄ± 3-4 hafta ara verilebilir.
                    </div>
                    <div class="rationale-tip">
                        <strong>ðŸª Premium Market:</strong> Lansmanda yoÄŸun yatÄ±rÄ±m yapÄ±n, carryover etkiyle sÃ¼rdÃ¼rÃ¼n.
                    </div>`
                },
                saturation: {
                    main: `<p><strong>Saturation GrafiÄŸi Ne GÃ¶steriyor?</strong> Harcama arttÄ±kÃ§a elde edilen etkinin nasÄ±l deÄŸiÅŸtiÄŸini gÃ¶sterir.</p>
                    <p><strong>Maksimum Senaryo (Î± = 2.5, Î³ = 0.6):</strong> YÃ¼ksek alpha = <span class="highlight-green">doygunluÄŸa ulaÅŸmak zor</span>.</p>`,
                    scenario: `<p><strong>ðŸ“ˆ Maksimum Saturation Ã–zellikleri:</strong></p>
                    <ul>
                        <li>Ã‡ok yÃ¼ksek GRP'lerde bile doygunluk zor</li>
                        <li>Her ek GRP marjinal katkÄ± saÄŸlar</li>
                        <li>Uzun vadeli marka inÅŸasÄ± iÃ§in ideal</li>
                    </ul>`
                },
                reach: {
                    main: `<p><strong>GRP-Reach GrafiÄŸi Ne GÃ¶steriyor?</strong> KÃ¼mÃ¼latif GRP'nin ne kadar kitleye ulaÅŸtÄ±ÄŸÄ±nÄ± gÃ¶sterir.</p>`,
                    scenario: `<p><strong>ðŸ“Œ Maksimum Senaryo iÃ§in Reach Stratejisi:</strong></p>
                    <ul>
                        <li><strong>1+ Reach:</strong> â­ Ã–nerilen - maksimum kitleye ulaÅŸÄ±m</li>
                    </ul>
                    <div class="rationale-recommendation">
                        <strong>ðŸ’¡ Aksiyon:</strong> 1+ Reach %60+ hedefleyin. Ä°lk 2-3 haftada yoÄŸun GRP.
                    </div>`
                }
            }
        };

        // Generate dynamic Saturation Rationale based on analysis data
        function generateSaturationRationale(scenario) {
            const alpha = parseFloat(document.getElementById('alphaParam').value);
            const gamma = parseFloat(document.getElementById('gammaParam').value);
            
            // Check if we have analysis data
            if (!analysisData || !analysisData.adstock || analysisData.adstock.length === 0) {
                // No data yet - show basic explanation
                return `
                    ${scenario.saturation.main}
                    <div class="rationale-scenario">
                        <div class="rationale-scenario-title">${scenario.icon} ${scenario.name} Senaryo Etkisi</div>
                        ${scenario.saturation.scenario}
                    </div>
                    <div class="rationale-tip">
                        <strong>ðŸ“Š Analiz Bekleniyor:</strong> Analizi Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nÄ±zda alternatiflerinizin saturation performansÄ± burada detaylÄ± gÃ¶rÃ¼necek.
                    </div>
                `;
            }

            // Get alternatives data from stored analysis
            const grpAlt1 = document.getElementById('grpAlt1').value.split(',').map(s => parseFloat(s.trim())).filter(n => !isNaN(n));
            const grpAlt2 = document.getElementById('grpAlt2').value.split(',').map(s => parseFloat(s.trim())).filter(n => !isNaN(n));
            const grpAlt3 = document.getElementById('grpAlt3').value.split(',').map(s => parseFloat(s.trim())).filter(n => !isNaN(n));
            const cpp = parseFloat(document.getElementById('cppValue').value) || 25000;
            const decayRate = parseFloat(document.getElementById('decayRate').value);

            // Calculate adstock and saturation for each alternative
            const calcAltMetrics = (grpArr) => {
                if (grpArr.length === 0) return null;
                const spend = grpArr.map(g => g * cpp);
                const adstock = calculateAdstock(spend, decayRate);
                const saturation = adstock.map(a => calculateSaturation(a, alpha, gamma));
                const avgAdstock = adstock.reduce((a, b) => a + b, 0) / adstock.length;
                const avgSaturation = saturation.reduce((a, b) => a + b, 0) / saturation.length;
                const maxSaturation = Math.max(...saturation);
                const minSaturation = Math.min(...saturation);
                return { avgAdstock, avgSaturation, maxSaturation, minSaturation, adstock, saturation };
            };

            const alt1 = calcAltMetrics(grpAlt1);
            const alt2 = calcAltMetrics(grpAlt2);
            const alt3 = calcAltMetrics(grpAlt3);

            // Calculate optimal point
            const allAdstock = [...(alt1?.adstock || []), ...(alt2?.adstock || []), ...(alt3?.adstock || [])];
            const optimalBudget = findOptimalBudget(alpha, gamma, allAdstock);
            const optimalSaturation = calculateSaturation(optimalBudget, alpha, gamma);

            // Build comparison analysis
            let altComparison = '<div class="rationale-data-section"><strong>ðŸ“ˆ Alternatif KarÅŸÄ±laÅŸtÄ±rmasÄ±:</strong><table class="rationale-table"><thead><tr><th></th><th>Ort. Saturation</th><th>Max</th><th>Durum</th></tr></thead><tbody>';
            
            const evalStatus = (avgSat) => {
                if (avgSat >= 0.85) return { text: 'âš ï¸ Doygunluk', class: 'status-warning' };
                if (avgSat >= 0.6) return { text: 'âœ… Verimli', class: 'status-good' };
                return { text: 'ðŸ“ˆ Potansiyel Var', class: 'status-info' };
            };

            if (alt1) {
                const status = evalStatus(alt1.avgSaturation);
                altComparison += `<tr><td><span class="alt-badge alt1">1</span></td><td>%${(alt1.avgSaturation * 100).toFixed(1)}</td><td>%${(alt1.maxSaturation * 100).toFixed(1)}</td><td class="${status.class}">${status.text}</td></tr>`;
            }
            if (alt2) {
                const status = evalStatus(alt2.avgSaturation);
                altComparison += `<tr><td><span class="alt-badge alt2">2</span></td><td>%${(alt2.avgSaturation * 100).toFixed(1)}</td><td>%${(alt2.maxSaturation * 100).toFixed(1)}</td><td class="${status.class}">${status.text}</td></tr>`;
            }
            if (alt3) {
                const status = evalStatus(alt3.avgSaturation);
                altComparison += `<tr><td><span class="alt-badge alt3">3</span></td><td>%${(alt3.avgSaturation * 100).toFixed(1)}</td><td>%${(alt3.maxSaturation * 100).toFixed(1)}</td><td class="${status.class}">${status.text}</td></tr>`;
            }
            altComparison += '</tbody></table></div>';

            // Find best alternative
            const alts = [
                { name: 'Alt-1', data: alt1, color: '#00d4ff' },
                { name: 'Alt-2', data: alt2, color: '#ff6b35' },
                { name: 'Alt-3', data: alt3, color: '#10b981' }
            ].filter(a => a.data);

            let bestAlt = alts[0];
            let recommendation = '';

            // Determine best based on efficiency (not too high saturation, not too low)
            alts.forEach(a => {
                // Ideal is around 60-80% saturation
                const distanceFromIdeal = Math.abs(a.data.avgSaturation - 0.7);
                const bestDistance = Math.abs(bestAlt.data.avgSaturation - 0.7);
                if (distanceFromIdeal < bestDistance) {
                    bestAlt = a;
                }
            });

            // Generate recommendation based on situation
            const avgSatAll = alts.reduce((sum, a) => sum + a.data.avgSaturation, 0) / alts.length;
            
            if (avgSatAll > 0.85) {
                recommendation = `
                    <div class="rationale-recommendation warning">
                        <strong>âš ï¸ Dikkat: YÃ¼ksek Doygunluk BÃ¶lgesi</strong>
                        <p>TÃ¼m alternatifler %85+ saturation seviyesinde. Bu demek ki:</p>
                        <ul>
                            <li>Her ek TL harcama iÃ§in <span class="highlight">azalan getiri</span> alÄ±yorsunuz</li>
                            <li>Optimal nokta (${(optimalBudget/1000000).toFixed(1)}M TL) aÅŸÄ±lmÄ±ÅŸ durumda</li>
                            <li>BÃ¼tÃ§eyi artÄ±rmak yerine <strong>frekans veya timing optimizasyonu</strong> dÃ¼ÅŸÃ¼nÃ¼n</li>
                        </ul>
                        <p><strong>Ã–neri:</strong> HaftalÄ±k harcamayÄ± ${(optimalBudget/1000000).toFixed(1)}M TL civarÄ±na Ã§ekerek verimliliÄŸi artÄ±rabilirsiniz.</p>
                    </div>`;
            } else if (avgSatAll > 0.6) {
                recommendation = `
                    <div class="rationale-recommendation">
                        <strong>âœ… Verimli BÃ¶lge</strong>
                        <p>Alternatifleriniz %60-85 saturation bandÄ±nda - bu iyi bir verimlilik seviyesi.</p>
                        <p><strong>${bestAlt.name}</strong> en dengeli performansÄ± gÃ¶steriyor (Ort: %${(bestAlt.data.avgSaturation * 100).toFixed(1)}).</p>
                        <p><strong>Ã–neri:</strong> Mevcut stratejiyle devam edebilir veya ${bestAlt.name} daÄŸÄ±lÄ±mÄ±nÄ± baz alabilirsiniz.</p>
                    </div>`;
            } else {
                recommendation = `
                    <div class="rationale-recommendation info">
                        <strong>ðŸ“ˆ BÃ¼yÃ¼me Potansiyeli Var</strong>
                        <p>Saturation seviyeleri %60'Ä±n altÄ±nda - bÃ¼tÃ§e artÄ±ÅŸÄ±ndan verim alabilirsiniz.</p>
                        <p>Optimal noktaya (${(optimalBudget/1000000).toFixed(1)}M TL) kadar harcama artÄ±ÅŸÄ± dÃ¼ÅŸÃ¼nÃ¼lebilir.</p>
                        <p><strong>Ã–neri:</strong> HaftalÄ±k GRP'yi artÄ±rarak daha yÃ¼ksek saturation ve etki elde edebilirsiniz.</p>
                    </div>`;
            }

            // Build final HTML
            return `
                <p><strong>Saturation GrafiÄŸi Ne GÃ¶steriyor?</strong> Her alternatifin haftalÄ±k adstock deÄŸerlerinin saturation eÄŸrisi Ã¼zerindeki konumunu gÃ¶sterir. KÄ±rmÄ±zÄ± Ã§izgi optimal harcama noktasÄ±nÄ± (${(optimalBudget/1000000).toFixed(1)}M TL, %${(optimalSaturation * 100).toFixed(0)} saturation) iÅŸaretler.</p>
                
                ${altComparison}
                
                ${recommendation}
                
                <div class="rationale-scenario">
                    <div class="rationale-scenario-title">${scenario.icon} ${scenario.name} Senaryo Etkisi</div>
                    ${scenario.saturation.scenario}
                </div>
            `;
        }

        // Update all rationales based on current scenario and frequency
        function updateAllRationales() {
            try {
                const scenario = scenarioRationales[currentScenario];
                const freq = currentReachFrequency;
                const freqLabel = freq === 'all' ? 'TÃ¼m Frekanslar (1+, 2+, 3+)' : reachParams[freq].label;

                // Adstock Rationale
                document.getElementById('adstockRationale').innerHTML = `
                    ${scenario.adstock.main}
                    <div class="rationale-scenario">
                        <div class="rationale-scenario-title">${scenario.icon} ${scenario.name} Senaryo Etkisi</div>
                        ${scenario.adstock.scenario}
                    </div>
                `;

                // Saturation Rationale - DYNAMIC based on analysis data
                const saturationDynamic = generateSaturationRationale(scenario);
                document.getElementById('saturationRationale').innerHTML = saturationDynamic;

                // Reach Rationale (also depends on frequency)
                const freqExplanation = freq === 'all' ? 
                    `<p><strong>GÃ¶rÃ¼ntÃ¼leme:</strong> TÃ¼m frekans eÄŸrileri karÅŸÄ±laÅŸtÄ±rmalÄ± olarak gÃ¶steriliyor.</p>
                    <ul>
                        <li><span style="color: #00d4ff;">â—</span> <strong>Mavi (1+):</strong> En az 1 kez ulaÅŸÄ±lan kitle</li>
                        <li><span style="color: #ff6b35;">â—</span> <strong>Turuncu (2+):</strong> En az 2 kez ulaÅŸÄ±lan kitle</li>
                        <li><span style="color: #8888a0;">â—</span> <strong>Gri (3+):</strong> En az 3 kez ulaÅŸÄ±lan kitle</li>
                    </ul>` :
                    `<p><strong>SeÃ§ili Frekans: ${freqLabel}</strong></p>`;

                document.getElementById('reachRationale').innerHTML = `
                    ${scenario.reach.main}
                    ${freqExplanation}
                    <div class="rationale-scenario">
                        <div class="rationale-scenario-title">${scenario.icon} ${scenario.name} Senaryo Etkisi</div>
                        ${scenario.reach.scenario}
                    </div>
                `;

                // Carryover Rationale
                document.getElementById('carryoverRationale').innerHTML = `
                    ${scenario.carryover.main}
                    <div class="rationale-scenario">
                        <div class="rationale-scenario-title">${scenario.icon} ${scenario.name} Senaryo Etkisi</div>
                        ${scenario.carryover.scenario}
                    </div>
                `;
            } catch (error) {
                console.error('Update rationales error:', error);
            }
        }

        // Set reach frequency filter
        function setReachFrequency(freq) {
            try {
                currentReachFrequency = freq;
                
                // Update buttons
                document.querySelectorAll('.reach-btn').forEach((btn) => {
                    const btnFreq = btn.textContent.includes('Hepsi') ? 'all' : 
                                   btn.textContent.includes('1+') ? 1 :
                                   btn.textContent.includes('2+') ? 2 : 3;
                    btn.classList.toggle('active', btnFreq === freq);
                });
                
                // Update label
                if (freq === 'all') {
                    document.getElementById('reachFreqLabel').textContent = '1+/2+/3+ Reach';
                } else {
                    document.getElementById('reachFreqLabel').textContent = reachParams[freq].label;
                }
                
                // Redraw reach chart
                updateReachChart();
                
                // Update rationales
                updateAllRationales();
            } catch (error) {
                console.error('Set reach frequency error:', error);
            }
        }

        // Calculate reach based on GRP using logarithmic curve
        function calculateReach(grp, freq) {
            // Handle 'all' case by defaulting to freq 1
            const actualFreq = freq === 'all' ? 1 : freq;
            const params = reachParams[actualFreq];
            // Logarithmic reach curve: Reach = maxReach * (1 - e^(-k * GRP))
            return params.maxReach * (1 - Math.exp(-params.k * grp));
        }

        // Find optimal GRP (where marginal reach gain drops below threshold)
        function findOptimalGRP(freq) {
            // Handle 'all' case by defaulting to freq 1
            const actualFreq = freq === 'all' ? 1 : freq;
            const params = reachParams[actualFreq];
            // Optimal is around where the curve starts to flatten significantly
            // This is approximately where we've reached ~60-70% of max reach
            return Math.log(0.35) / (-params.k); // ~60% of max reach
        }

        // Set input mode
        // Initialize charts
        function initCharts() {
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#8888a0',
                            font: { family: 'Sora', size: 11 }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: { color: 'rgba(255,255,255,0.05)' },
                        ticks: { color: '#8888a0', font: { size: 10 } }
                    },
                    y: {
                        grid: { color: 'rgba(255,255,255,0.05)' },
                        ticks: { color: '#8888a0', font: { size: 10 } }
                    }
                }
            };

            // Adstock Chart - Stacked bar (Actual + Carried-Over) + Line (Total Adstock)
            adstockChart = new Chart(document.getElementById('adstockChart'), {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    ...chartOptions,
                    plugins: {
                        ...chartOptions.plugins,
                        annotation: {
                            annotations: {}
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label;
                                    const value = context.raw;
                                    if (label === 'Total Adstock') {
                                        return `${label}: ${value.toFixed(0)} GRP eq.`;
                                    }
                                    return `${label}: ${value.toFixed(0)} GRP`;
                                }
                            }
                        },
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                color: '#8888a0',
                                font: { size: 10 },
                                usePointStyle: true,
                                padding: 15
                            }
                        }
                    },
                    scales: {
                        x: chartOptions.scales.x,
                        y: {
                            ...chartOptions.scales.y,
                            stacked: true,
                            title: { display: false },
                            beginAtZero: true
                        }
                    }
                }
            });

            // Saturation Chart with annotation
            saturationChart = new Chart(document.getElementById('saturationChart'), {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Saturation Curve',
                            data: [],
                            borderColor: '#ff6b35',
                            backgroundColor: 'rgba(255, 107, 53, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 2
                        },
                        {
                            label: 'Veri NoktalarÄ±',
                            data: [],
                            borderColor: '#10b981',
                            backgroundColor: '#10b981',
                            pointRadius: 8,
                            pointStyle: 'circle',
                            showLine: false
                        }
                    ]
                },
                options: {
                    ...chartOptions,
                    plugins: {
                        ...chartOptions.plugins,
                        annotation: {
                            annotations: {}
                        }
                    },
                    scales: {
                        x: {
                            ...chartOptions.scales.x,
                            type: 'linear',
                            title: { display: true, text: 'Harcama (Milyon TL)', color: '#8888a0' }
                        },
                        y: {
                            ...chartOptions.scales.y,
                            title: { display: true, text: 'Saturation (%)', color: '#8888a0' },
                            max: 1
                        }
                    }
                }
            });

            // Carryover Chart - Weekly carryover effect
            carryoverChart = new Chart(document.getElementById('carryoverChart'), {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    ...chartOptions,
                    plugins: {
                        ...chartOptions.plugins,
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${formatNumber(context.raw)} TL`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: chartOptions.scales.x,
                        y: {
                            ...chartOptions.scales.y,
                            title: { display: true, text: 'Carryover (TL)', color: '#8888a0' },
                            beginAtZero: true
                        }
                    }
                }
            });

            // Reach Chart
            reachChart = new Chart(document.getElementById('reachChart'), {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: '1+ Reach',
                            data: [],
                            borderColor: '#00d4ff',
                            backgroundColor: 'rgba(0, 212, 255, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    ...chartOptions,
                    plugins: {
                        ...chartOptions.plugins,
                        annotation: {
                            annotations: {}
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Reach: %${context.parsed.y.toFixed(1)}`;
                                },
                                title: function(context) {
                                    return `GRP: ${context[0].label}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ...chartOptions.scales.x,
                            type: 'linear',
                            title: { display: true, text: 'GRP', color: '#8888a0' },
                            min: 0,
                            max: 400
                        },
                        y: {
                            ...chartOptions.scales.y,
                            title: { display: true, text: 'EriÅŸim Seviyesi (%)', color: '#8888a0' },
                            min: 0,
                            max: 80
                        }
                    }
                }
            });
        }

        // Update Reach Chart
        function updateReachChart() {
            try {
                const freq = currentReachFrequency;
                const maxGRPRange = 2000;
                
                // Colors for each frequency
                const freqColors = {
                    1: { border: '#00d4ff', bg: 'rgba(0, 212, 255, 0.1)', point: '#00d4ff' },
                    2: { border: '#ff6b35', bg: 'rgba(255, 107, 53, 0.1)', point: '#ff6b35' },
                    3: { border: '#8888a0', bg: 'rgba(136, 136, 160, 0.1)', point: '#8888a0' }
                };
                
                let datasets = [];
                
                if (freq === 'all') {
                    // Show all three curves
                    [1, 2, 3].forEach(f => {
                        const curveData = [];
                        for (let grp = 0; grp <= maxGRPRange; grp += 50) {
                            const reach = calculateReach(grp, f);
                            curveData.push({ x: grp, y: reach });
                        }
                        datasets.push({
                            label: reachParams[f].label,
                            data: curveData,
                            borderColor: freqColors[f].border,
                            backgroundColor: 'transparent',
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0,
                            borderWidth: 2
                        });
                    });
                    
                    // Add data points for ALL frequencies if analysis data exists
                    if (analysisData.grp && analysisData.grp.length > 0) {
                        [1, 2, 3].forEach(f => {
                            const dataPoints = [];
                            let cumulativeGRP = 0;
                            
                            analysisData.grp.forEach((g, i) => {
                                cumulativeGRP += g;
                                const reach = calculateReach(cumulativeGRP, f);
                                dataPoints.push({ x: cumulativeGRP, y: reach });
                            });
                            
                            datasets.push({
                                label: `Alt-1 (${f}+)`,
                                data: dataPoints,
                                borderColor: freqColors[f].point,
                                backgroundColor: freqColors[f].point,
                                pointRadius: 5,
                                pointStyle: 'circle',
                                showLine: false
                            });
                        });
                    }
                    
                    reachChart.options.plugins.annotation.annotations = {};
                    
                    const reach1at250 = calculateReach(250, 1);
                    document.getElementById('reachMaxGRP').textContent = maxGRPRange;
                    document.getElementById('reachMaxPercent').textContent = `%${reach1at250.toFixed(1)} (1+)`;
                    document.getElementById('reachOptimalGRP').textContent = '-';
                    
                } else {
                    // Single frequency mode
                    const params = reachParams[freq];
                    const curveData = [];
                    
                    for (let grp = 0; grp <= maxGRPRange; grp += 50) {
                        const reach = calculateReach(grp, freq);
                        curveData.push({ x: grp, y: reach });
                    }
                    
                    datasets.push({
                        label: params.label,
                        data: curveData,
                        borderColor: freqColors[freq].border,
                        backgroundColor: freqColors[freq].bg,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        borderWidth: 2
                    });
                    
                    const optimalGRP = findOptimalGRP(freq);
                    
                    reachChart.options.plugins.annotation.annotations = {
                        optimalLine: {
                            type: 'line',
                            xMin: optimalGRP,
                            xMax: optimalGRP,
                            borderColor: '#ef4444',
                            borderWidth: 2,
                            label: {
                                display: true,
                                content: `Optimal: ${Math.round(optimalGRP)} GRP`,
                                position: 'start',
                                backgroundColor: '#ef4444',
                                color: 'white',
                                font: { size: 10 }
                            }
                        }
                    };
                    
                    // Add data points for THIS frequency
                    if (analysisData.grp && analysisData.grp.length > 0) {
                        const dataPoints = [];
                        let cumulativeGRP = 0;
                        
                        analysisData.grp.forEach((g, i) => {
                            cumulativeGRP += g;
                            const reach = calculateReach(cumulativeGRP, freq);
                            dataPoints.push({ x: cumulativeGRP, y: reach });
                        });
                        
                        datasets.push({
                            label: 'Kampanya Verileri',
                            data: dataPoints,
                            borderColor: '#10b981',
                            backgroundColor: '#10b981',
                            pointRadius: 6,
                            pointStyle: 'circle',
                            showLine: false
                        });
                    }
                    
                    const maxGRPRef = 250;
                    const reachAt250 = calculateReach(maxGRPRef, freq);
                    document.getElementById('reachMaxGRP').textContent = maxGRPRef;
                    document.getElementById('reachMaxPercent').textContent = `%${reachAt250.toFixed(1)}`;
                    document.getElementById('reachOptimalGRP').textContent = Math.round(optimalGRP);
                }
                
                reachChart.data.datasets = datasets;
                reachChart.options.scales.x.max = maxGRPRange;
                reachChart.update();
            } catch (error) {
                console.error('Reach chart update error:', error);
            }
        }

        // Calculate Adstock
        function calculateAdstock(spend, decay) {
            const adstock = [];
            for (let i = 0; i < spend.length; i++) {
                if (i === 0) {
                    adstock.push(spend[i]);
                } else {
                    adstock.push(spend[i] + decay * adstock[i - 1]);
                }
            }
            return adstock;
        }

        // Calculate Saturation (Hill function)
        function calculateSaturation(value, alpha, gamma) {
            const scaledValue = value / 1000000; // Scale to millions
            const alphaGamma = Math.pow(alpha, gamma);
            const valueGamma = Math.pow(scaledValue, gamma);
            return valueGamma / (alphaGamma + valueGamma);
        }

        // Find optimal budget point (where marginal return drops significantly)
        // Find optimal budget - now takes actual adstock values into account
        function findOptimalBudget(alpha, gamma, adstockValues) {
            // If we have actual adstock values, find the point of diminishing returns
            // based on the marginal efficiency curve
            if (adstockValues && adstockValues.length > 0) {
                const maxAdstock = Math.max(...adstockValues);
                const avgAdstock = adstockValues.reduce((a, b) => a + b, 0) / adstockValues.length;
                
                // Optimal is where marginal saturation starts declining significantly
                // For Hill function: inflection point is around alpha
                // Scale alpha to the actual data range
                const scaleFactor = avgAdstock / (alpha * 1000000);
                
                // Optimal is typically at 50-70% of saturation
                // Find the adstock value that gives ~50% saturation
                const targetSaturation = 0.5;
                // Inverse Hill function: x = alpha * (S / (1-S))^(1/gamma)
                const optimalAdstock = alpha * 1000000 * Math.pow(targetSaturation / (1 - targetSaturation), 1 / gamma);
                
                return optimalAdstock;
            }
            
            // Fallback: theoretical optimal based on alpha
            return alpha * 0.6 * 1000000;
        }

        // Run Analysis
        function runAnalysis() {
            const decayRate = parseFloat(document.getElementById('decayRate').value);
            const alpha = parseFloat(document.getElementById('alphaParam').value);
            const gamma = parseFloat(document.getElementById('gammaParam').value);
            const baseline = parseFloat(document.getElementById('baseline').value);
            const maxLift = parseFloat(document.getElementById('maxLift').value) / 100;
            const cpp = parseFloat(document.getElementById('cppValue').value) || 25000;

            // Get 3 alternatives
            const grpAlt1 = document.getElementById('grpAlt1').value.split(',').map(s => parseFloat(s.trim())).filter(n => !isNaN(n));
            const grpAlt2 = document.getElementById('grpAlt2').value.split(',').map(s => parseFloat(s.trim())).filter(n => !isNaN(n));
            const grpAlt3 = document.getElementById('grpAlt3').value.split(',').map(s => parseFloat(s.trim())).filter(n => !isNaN(n));

            if (grpAlt1.length === 0) {
                alert('LÃ¼tfen en az Alt-1 iÃ§in GRP verisi girin!');
                return;
            }

            // Calculate spend from GRP
            const spendAlt1 = grpAlt1.map(g => g * cpp);
            const spendAlt2 = grpAlt2.map(g => g * cpp);
            const spendAlt3 = grpAlt3.map(g => g * cpp);

            // Update summary
            const totalGRP1 = grpAlt1.reduce((a, b) => a + b, 0);
            const totalGRP2 = grpAlt2.length > 0 ? grpAlt2.reduce((a, b) => a + b, 0) : 0;
            const totalGRP3 = grpAlt3.length > 0 ? grpAlt3.reduce((a, b) => a + b, 0) : 0;
            
            document.getElementById('summaryAlt1').textContent = `${totalGRP1} GRP`;
            document.getElementById('summaryAlt2').textContent = grpAlt2.length > 0 ? `${totalGRP2} GRP` : '- GRP';
            document.getElementById('summaryAlt3').textContent = grpAlt3.length > 0 ? `${totalGRP3} GRP` : '- GRP';

            // Calculate for each alternative
            const calcAlternative = (spend, grp) => {
                if (spend.length === 0) return null;
                const adstock = calculateAdstock(spend, decayRate);
                const saturation = adstock.map(a => calculateSaturation(a, alpha, gamma));
                const tvEffect = saturation.map(s => baseline * maxLift * s);
                const response = saturation.map((s, i) => baseline + tvEffect[i]);
                const weeklyEfficiency = spend.map((s, i) => s > 0 ? (tvEffect[i] / s) : 0);
                const totalSpend = spend.reduce((a, b) => a + b, 0);
                const totalTVEffect = tvEffect.reduce((a, b) => a + b, 0);
                const totalResponse = response.reduce((a, b) => a + b, 0);
                return { spend, grp, adstock, saturation, tvEffect, response, weeklyEfficiency, totalSpend, totalTVEffect, totalResponse };
            };

            const alt1 = calcAlternative(spendAlt1, grpAlt1);
            const alt2 = calcAlternative(spendAlt2, grpAlt2);
            const alt3 = calcAlternative(spendAlt3, grpAlt3);

            // Store primary data for export (Alt-1)
            analysisData = { 
                spend: alt1.spend, 
                grp: grpAlt1, 
                adstock: alt1.adstock, 
                saturation: alt1.saturation, 
                tvEffect: alt1.tvEffect, 
                response: alt1.response, 
                weeklyROI: alt1.spend.map((s, i) => s > 0 ? ((alt1.tvEffect[i] / s) * 100) : 0),
                weeklyEfficiency: alt1.weeklyEfficiency 
            };

            // Calculate summary metrics (using Alt-1 as primary)
            // Combine all adstock values for optimal calculation
            const allAdstockValues = [...alt1.adstock];
            if (alt2) allAdstockValues.push(...alt2.adstock);
            if (alt3) allAdstockValues.push(...alt3.adstock);
            
            const optimalBudget = findOptimalBudget(alpha, gamma, allAdstockValues);
            const peakEffect = Math.max(...alt1.saturation) * 100;
            const tvEfficiencyIndex = alt1.totalSpend > 0 ? (alt1.totalTVEffect / alt1.totalSpend) * 100 : 0;

            // Update metrics cards
            document.getElementById('totalSpend').textContent = formatNumber(alt1.totalSpend) + ' TL';
            document.getElementById('avgAdstock').textContent = formatNumber(alt1.adstock.reduce((a, b) => a + b, 0) / alt1.adstock.length);
            document.getElementById('peakEffect').textContent = peakEffect.toFixed(1) + '%';
            document.getElementById('totalResponse').textContent = formatNumber(alt1.totalResponse) + ' TL';
            document.getElementById('tvEfficiency').textContent = tvEfficiencyIndex.toFixed(1);
            document.getElementById('overallROI').textContent = formatNumber(alt1.totalTVEffect) + ' TL';
            document.getElementById('optimalBudget').textContent = formatNumber(optimalBudget) + ' TL/hafta';

            // Determine max weeks for labels
            const maxWeeks = Math.max(grpAlt1.length, grpAlt2.length || 0, grpAlt3.length || 0);
            const labels = Array.from({length: maxWeeks}, (_, i) => `H${i + 1}`);

            // Store data for adstock/carryover chart updates
            window.adstockData = {
                labels,
                alt1: { grp: grpAlt1, adstock: alt1.adstock, spend: spendAlt1 },
                alt2: alt2 ? { grp: grpAlt2, adstock: alt2.adstock, spend: spendAlt2 } : null,
                alt3: alt3 ? { grp: grpAlt3, adstock: alt3.adstock, spend: spendAlt3 } : null
            };

            // Update Adstock Chart with current selection
            updateAdstockChart();

            // Update Carryover Chart with current selection
            updateCarryoverChart();

            // Saturation Chart with curve and data points for all alternatives
            const allAdstock = [...alt1.adstock, ...(alt2?.adstock || []), ...(alt3?.adstock || [])];
            const maxSpend = Math.max(...allAdstock) * 1.5;
            const curveData = [];
            for (let i = 0; i <= 50; i++) {
                const x = (maxSpend / 50) * i;
                curveData.push({ x: x / 1000000, y: calculateSaturation(x, alpha, gamma) });
            }
            
            saturationChart.data.datasets = [
                {
                    label: 'Saturation EÄŸrisi',
                    data: curveData,
                    borderColor: '#8888a0',
                    backgroundColor: 'rgba(136, 136, 160, 0.05)',
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0,
                    borderWidth: 1
                },
                {
                    label: 'Alt-1',
                    data: alt1.adstock.map((a, i) => ({ x: a / 1000000, y: alt1.saturation[i] })),
                    borderColor: '#00d4ff',
                    backgroundColor: '#00d4ff',
                    pointRadius: 6,
                    pointStyle: 'circle',
                    showLine: false
                }
            ];
            if (alt2) {
                saturationChart.data.datasets.push({
                    label: 'Alt-2',
                    data: alt2.adstock.map((a, i) => ({ x: a / 1000000, y: alt2.saturation[i] })),
                    borderColor: '#ff6b35',
                    backgroundColor: '#ff6b35',
                    pointRadius: 6,
                    pointStyle: 'triangle',
                    showLine: false
                });
            }
            if (alt3) {
                saturationChart.data.datasets.push({
                    label: 'Alt-3',
                    data: alt3.adstock.map((a, i) => ({ x: a / 1000000, y: alt3.saturation[i] })),
                    borderColor: '#10b981',
                    backgroundColor: '#10b981',
                    pointRadius: 6,
                    pointStyle: 'rect',
                    showLine: false
                });
            }
            
            // Add optimal point annotation
            const optimalX = optimalBudget / 1000000;
            const optimalY = calculateSaturation(optimalBudget, alpha, gamma);
            
            saturationChart.options.plugins.annotation.annotations = {
                optimalLine: {
                    type: 'line',
                    xMin: optimalX,
                    xMax: optimalX,
                    borderColor: '#ef4444',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    label: {
                        display: true,
                        content: `Optimal: ${optimalX.toFixed(1)}M`,
                        position: 'start',
                        backgroundColor: '#ef4444',
                        color: 'white',
                        font: { size: 10 }
                    }
                }
            };
            saturationChart.update();

            // Update Reach Chart
            updateReachChart();
        }

        // Update Adstock Chart based on selected alternative
        function updateAdstockChart() {
            if (!window.adstockData) return;
            
            const data = window.adstockData;
            const altNum = currentAdstockAlt;
            const altData = altNum === 1 ? data.alt1 : altNum === 2 ? data.alt2 : data.alt3;
            
            if (!altData) {
                currentAdstockAlt = 1;
                updateAdstockChart();
                return;
            }

            // Calculate carryover (adstock - current spend)
            const carryover = altData.adstock.map((a, i) => Math.max(0, a - altData.spend[i]));
            
            // Scale carryover to GRP units for visualization
            // Find the ratio between max adstock and max GRP
            const maxGRP = Math.max(...altData.grp);
            const maxAdstock = Math.max(...altData.adstock);
            const scaleFactor = maxGRP > 0 && maxAdstock > 0 ? maxGRP / maxAdstock : 1;
            
            // Scale values to GRP units
            const carryoverScaled = carryover.map(c => c * scaleFactor);
            const adstockScaled = altData.adstock.map(a => a * scaleFactor);

            adstockChart.data.labels = data.labels;
            adstockChart.data.datasets = [
                // Actual Investment (GRP) - KÄ±rmÄ±zÄ± bar
                {
                    label: 'Actual Investment',
                    data: altData.grp,
                    backgroundColor: 'rgba(220, 53, 69, 0.85)',
                    borderColor: 'rgba(220, 53, 69, 1)',
                    borderWidth: 1,
                    stack: 'stack1',
                    order: 2
                },
                // Carried-Over Investment - Gri bar (Ã¼stte)
                {
                    label: 'Carried-Over Investment',
                    data: carryoverScaled,
                    backgroundColor: 'rgba(180, 180, 180, 0.7)',
                    borderColor: 'rgba(160, 160, 160, 0.9)',
                    borderWidth: 1,
                    stack: 'stack1',
                    order: 2
                },
                // Total Adstock - Ã‡izgi
                {
                    label: 'Total Adstock',
                    data: adstockScaled,
                    type: 'line',
                    borderColor: 'rgba(100, 100, 100, 0.8)',
                    backgroundColor: 'transparent',
                    borderWidth: 2,
                    pointRadius: 3,
                    pointBackgroundColor: 'rgba(100, 100, 100, 0.8)',
                    tension: 0.3,
                    fill: false,
                    order: 1
                }
            ];
            
            // Add reference lines at 200 and 500
            const maxValue = Math.max(...adstockScaled, ...altData.grp.map((g, i) => g + carryoverScaled[i]));
            adstockChart.options.plugins.annotation = {
                annotations: {
                    line200: {
                        type: 'line',
                        yMin: 200,
                        yMax: 200,
                        borderColor: 'rgba(150, 150, 150, 0.5)',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        label: {
                            display: true,
                            content: '200',
                            position: 'end',
                            backgroundColor: 'transparent',
                            color: 'rgba(150, 150, 150, 0.8)',
                            font: { size: 10 }
                        }
                    },
                    line500: {
                        type: 'line',
                        yMin: 500,
                        yMax: 500,
                        borderColor: 'rgba(150, 150, 150, 0.5)',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        label: {
                            display: true,
                            content: '500',
                            position: 'end',
                            backgroundColor: 'transparent',
                            color: 'rgba(150, 150, 150, 0.8)',
                            font: { size: 10 }
                        }
                    }
                }
            };
            
            adstockChart.update();
        }

        // Set Adstock Alternative
        function setAdstockAlt(alt) {
            currentAdstockAlt = alt;
            
            // Update buttons
            document.querySelectorAll('#adstock-tab .adstock-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i + 1 === alt);
            });
            
            updateAdstockChart();
        }

        // Update Carryover Chart based on selected alternative
        function updateCarryoverChart() {
            if (!window.adstockData) return;
            
            const data = window.adstockData;
            const altNum = currentCarryoverAlt;
            const altData = altNum === 1 ? data.alt1 : altNum === 2 ? data.alt2 : data.alt3;
            
            if (!altData) {
                currentCarryoverAlt = 1;
                updateCarryoverChart();
                return;
            }

            // Calculate carryover
            const carryover = altData.adstock.map((a, i) => Math.max(0, a - altData.spend[i]));
            
            const colors = {
                1: { bg: 'rgba(0, 212, 255, 0.7)', border: '#00d4ff' },
                2: { bg: 'rgba(255, 107, 53, 0.7)', border: '#ff6b35' },
                3: { bg: 'rgba(16, 185, 129, 0.7)', border: '#10b981' }
            };

            carryoverChart.data.labels = data.labels;
            carryoverChart.data.datasets = [
                {
                    label: `Alt-${altNum} Carryover`,
                    data: carryover,
                    backgroundColor: colors[altNum].bg,
                    borderColor: colors[altNum].border,
                    borderWidth: 1
                }
            ];
            carryoverChart.update();
        }

        // Set Carryover Alternative
        function setCarryoverAlt(alt) {
            currentCarryoverAlt = alt;
            
            // Update buttons
            document.querySelectorAll('#carryover-tab .adstock-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i + 1 === alt);
            });
            
            updateCarryoverChart();
        }

        // Format number
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(2) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toFixed(0);
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // Toggle card collapse
        function toggleCard(header) {
            header.closest('.card').classList.toggle('collapsed');
        }

        // Apply scenario presets - Min/Opt/Max
        function applyScenario(scenario) {
            currentScenario = scenario; // Update global scenario
            
            // Update buttons - support both old and new class names
            document.querySelectorAll('.scenario-btn, .scenario-btn-v').forEach(btn => btn.classList.remove('active'));
            if (event && event.target) {
                const btn = event.target.closest('.scenario-btn-v') || event.target.closest('.scenario-btn') || event.target;
                btn.classList.add('active');
            }

            // Scenario parameters
            const scenarios = {
                minimum: { decay: 0.45, alpha: 1.0, gamma: 1.3 },      // KÄ±sa etki, erken doygunluk, hÄ±zlÄ± baÅŸlangÄ±Ã§
                optimum: { decay: 0.70, alpha: 1.5, gamma: 0.8 },      // Orta etki, normal doygunluk, dengeli
                maksimum: { decay: 0.85, alpha: 2.5, gamma: 0.6 }      // Uzun etki, geÃ§ doygunluk, yavaÅŸ baÅŸlangÄ±Ã§
            };

            const s = scenarios[scenario];
            document.getElementById('decayRate').value = s.decay;
            document.getElementById('decayValue').textContent = s.decay.toFixed(2);
            document.getElementById('alphaParam').value = s.alpha;
            document.getElementById('alphaValue').textContent = s.alpha.toFixed(2);
            document.getElementById('gammaParam').value = s.gamma;
            document.getElementById('gammaValue').textContent = s.gamma.toFixed(2);

            // Update all tab rationales
            updateAllRationales();

            runAnalysis();
        }

        // Export to CSV
        function exportCSV() {
            if (!analysisData.spend || analysisData.spend.length === 0) {
                alert('Ã–nce analizi Ã§alÄ±ÅŸtÄ±rÄ±n!');
                return;
            }

            const headers = ['Hafta', 'Harcama (TL)', 'GRP', 'Adstock', 'Saturation (%)', 'TV Etkisi (TL)', 'Toplam SatÄ±ÅŸ (TL)', 'ROI (%)', 'TV Efficiency'];
            const rows = analysisData.spend.map((s, i) => [
                `Hafta ${i + 1}`,
                s.toFixed(0),
                analysisData.grp[i].toFixed(0),
                analysisData.adstock[i].toFixed(0),
                (analysisData.saturation[i] * 100).toFixed(2),
                analysisData.tvEffect[i].toFixed(0),
                analysisData.response[i].toFixed(0),
                analysisData.weeklyROI[i].toFixed(2),
                (analysisData.weeklyEfficiency[i] * 100).toFixed(2)
            ]);

            let csv = '\uFEFF'; // BOM for Excel UTF-8
            csv += headers.join(';') + '\n';
            csv += rows.map(r => r.join(';')).join('\n');

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'tv_analyzer_export.csv';
            link.click();
        }

        // Update parameter displays
        document.getElementById('decayRate').addEventListener('input', (e) => {
            document.getElementById('decayValue').textContent = parseFloat(e.target.value).toFixed(2);
        });

        document.getElementById('alphaParam').addEventListener('input', (e) => {
            document.getElementById('alphaValue').textContent = parseFloat(e.target.value).toFixed(2);
        });

        document.getElementById('gammaParam').addEventListener('input', (e) => {
            document.getElementById('gammaValue').textContent = parseFloat(e.target.value).toFixed(2);
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            updateAllRationales();
            runAnalysis();
        });
    </script>
</body>
</html>
